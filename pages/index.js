// https://nextui.org/docs/components

import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import ModalScanner from '../comps/ModalScanner'
import { Collapse, Grid, Text, Textarea } from '@nextui-org/react';
import React from 'react'
import getData from './getData';

const fetcher = (url) => fetch(url).then(res => res.json())

export default function Home() {
  const [materials, setMaterials] = React.useState(new Map())
  const [currentMaterial, setCurrentMaterial] = React.useState(null)

  const handleMaterialScanned = (text) => {
    if (!materials.has(text)) {
      // Find current material from example data and set
      const mat = getData().find(batch => batch.batchId == text)
      setMaterials(materials.set(text, mat))
      setCurrentMaterial(mat)
    }
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Dow Track Pack</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        {!!currentMaterial ?
          <Grid.Container gap={2}>
            <Grid xs={8}>
              <h2 style={{ fontSize: 'xx-large' }}>
                Dow Track Pack
              </h2>
            </Grid>
            <Grid xs={4}>
              <ModalScanner
                materials={materials}
                handleMaterialScanned={handleMaterialScanned}
              />
            </Grid>
          </Grid.Container> :
          <>
            <h3 className={styles.title} >
              Dow Track Pack
            </h3>
            <ModalScanner
              materials={materials}
              handleMaterialScanned={handleMaterialScanned}
            />
          </>
        }




        {!!currentMaterial &&
          <>
            <Textarea
              readOnly
              label="Batch Id"
              initialValue={currentMaterial.batchId}
              placeholder="N/A"
              minRows={1}
              width={'100%'}
            />
            <Grid.Container gap={1.5} justify="center">
              <Grid xs={6}>
                <Textarea
                  readOnly
                  label="Material Id"
                  placeholder="N/A"
                  initialValue={currentMaterial.materialId}
                  minRows={1}
                  width={'100%'}
                />
              </Grid>
              <Grid xs={6}>
                <Textarea
                  readOnly
                  label="Material Name"
                  placeholder="N/A"
                  initialValue="HDBP"
                  minRows={1}
                  width={'100%'}
                />
              </Grid>
            </Grid.Container>
            <Grid.Container gap={1.5}>
              <Grid xs={4}>
                <Textarea
                  readOnly
                  label="Customer Id"
                  initialValue={currentMaterial.customerId}
                  placeholder="N/A"
                  minRows={1}
                  width={'100%'}
                />
              </Grid>
              <Grid xs={8}>
                <Textarea
                  readOnly
                  label="Customer"
                  initialValue="Jeff"
                  placeholder="N/A"
                  minRows={1}
                  width={'100%'}
                />
              </Grid>
            </Grid.Container>
            <Textarea
              readOnly
              label="Site Created"
              initialValue={currentMaterial.siteCreated}
              placeholder="3475 E North Union Rd, Bay City, MI 48706"
              minRows={1}
              width={'100%'}
            />
            <Textarea
              readOnly
              label="Quantity"
              placeholder="0"
              initialValue={currentMaterial.quantity}
              minRows={1}
              width={'100%'}
            />

            <div>
              {/* Transit Info */}
              <Collapse.Group>
                <Collapse title="Transit Info">
                  {currentMaterial.transits.map(transit => {
                    return (
                      <Collapse.Group key={transit.transitId}>
                        <Collapse title={transit.transitId}>
                          <Textarea
                            readOnly
                            label="Transit Id"
                            placeholder="N/A"
                            initialValue={transit.transitId}
                            minRows={1}
                            width={'100%'}
                          />
                          <Grid.Container gap={1.5} justify="center">
                            <Grid xs={6}>
                              <Textarea
                                readOnly
                                label="Date & Time Departure"
                                placeholder="N/A"
                                initialValue={transit.dateTimeDeparture}
                                minRows={1}
                                width={'100%'}
                              />
                            </Grid>
                            <Grid xs={6}>
                              <Textarea
                                readOnly
                                label="Date & Time Received"
                                placeholder="N/A"
                                initialValue={transit.dateTimeReceived}
                                minRows={1}
                                width={'100%'}
                              />
                            </Grid>
                          </Grid.Container>
                          <Textarea
                            readOnly
                            label="Delivered From"
                            placeholder="N/A"
                            initialValue={transit.deliveredFrom}
                            minRows={1}
                            width={'100%'}
                          />
                          <Textarea
                            readOnly
                            label="Delivered To"
                            placeholder="N/A"
                            initialValue={transit.deliveredTo}
                            minRows={1}
                            width={'100%'}
                          />
                          <Grid.Container gap={1.5} justify="center">
                            <Grid xs={6}>
                              <Textarea
                                readOnly
                                label="Transit Type"
                                placeholder="N/A"
                                initialValue={transit.transitType}
                                minRows={1}
                                width={'100%'}
                              />
                            </Grid>
                            <Grid xs={6}>
                              <Textarea
                                readOnly
                                label="Arrived"
                                placeholder="No"
                                initialValue={transit.arrived ? 'Yes' : 'No'}
                                minRows={1}
                                width={'100%'}
                              />
                            </Grid>
                          </Grid.Container>
                        </Collapse>
                      </Collapse.Group>
                    )
                  })}
                </Collapse>
              </Collapse.Group>

              {/* Sustainability Metrics */}
              <Collapse.Group>
                <Collapse title="Sustainability Metrics">
                  <Textarea
                    readOnly
                    label="Carbon Emission"
                    placeholder="0"
                    initialValue={currentMaterial.sustainabilityMetrics.carbonEmission}
                    minRows={1}
                    width={'100%'}
                  />
                  <Textarea
                    readOnly
                    label="Electricity Used"
                    placeholder="0"
                    initialValue={currentMaterial.sustainabilityMetrics.electricityUsed}
                    minRows={1}
                    width={'100%'}
                  />
                  <Textarea
                    readOnly
                    label="Water Used"
                    placeholder="0"
                    initialValue={currentMaterial.sustainabilityMetrics.waterUsed}
                    minRows={1}
                    width={'100%'}
                  />
                  {
                    currentMaterial.sustainabilityMetrics.waste.map(waste => {
                      return (
                        <Text key={waste}>{waste}</Text>
                      )
                    })
                  }
                </Collapse>
              </Collapse.Group>

              {/* Raw Materials */}
              <Collapse.Group>
                <Collapse title="Raw Materials">
                  {
                    currentMaterial.rawMaterials.map(mat => {
                      return (
                        <Text key={mat}>{mat}</Text>
                      )
                    })
                  }
                </Collapse>
              </Collapse.Group>

              {/* <Collapse.Group>
                {
                  materials.map(value => {
                    return (
                      <Collapse title={'Item: ' + value} key={value}>
                        <Text>
                          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                          minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                          aliquip ex ea commodo consequat.
                        </Text>
                        <Textarea
                          label="asdasd"
                          placeholder="asdas"
                        />
                      </Collapse>
                    )
                  })
                }
              </Collapse.Group> */}
            </div>
          </>
        }
      </main>

      <footer className={styles.footer}>
        <a
          href="https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app"
          target="_blank"
          rel="noopener noreferrer"
        >
          Powered by{' '}
          <span className={styles.logo}>
            <Image src="/vercel.svg" alt="Vercel Logo" width={72} height={16} />
          </span>
        </a>
      </footer>
    </div>
  )
}
